<!-- runtime/src/main/resources/templates/fragments/mermaid-diagram.html -->
<div id="mermaid-diagram">
    <div class="diagram-header">
        <h2>ðŸ“Š Message Flow Diagram</h2>
        <button class="copy-mermaid-btn" onclick="copyMermaidCode()">
            ðŸ“‹ Copy Mermaid Code
        </button>
    </div>
    <!-- Hidden textarea with original code -->
    <textarea id="mermaid-source-code" style="display: none;">{diagram}</textarea>
    <!-- Rendered diagram -->
    <pre class="mermaid">{diagram}</pre>
</div>

<script>
function copyMermaidCode() {
    const mermaidSource = document.getElementById('mermaid-source-code').value;
    const btn = document.querySelector('.copy-mermaid-btn');

    navigator.clipboard.writeText(mermaidSource).then(() => {
        const originalText = btn.innerHTML;
        btn.innerHTML = 'âœ“ Copied!';
        btn.classList.add('copied');

        setTimeout(() => {
            btn.innerHTML = originalText;
            btn.classList.remove('copied');
        }, 2000);
    }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy to clipboard');
    });
}
</script>